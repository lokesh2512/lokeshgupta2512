/*! @wireapp/proteus v9.6.4 */
var Proteus=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=34)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.new_instance=function(e){try{return new e}catch(e){return e._instance}}},function(e,t){e.exports=sodium},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);class s extends n.ProteusError{constructor(e="Invalid input",t=4){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}}t.InputError=s,s.CODE={CASE_400:400,CASE_401:401,CASE_402:402,CASE_403:403,CASE_404:404,CASE_405:405,CASE_406:406,CASE_407:407,CASE_408:408,CASE_409:409},function(e){e.RangeError=class extends e{constructor(e="Invalid array length",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.TypeError=class extends e{constructor(e="Invalid type",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.ConversionError=class extends e{constructor(e="Conversion error",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}}}(s=t.InputError||(t.InputError={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(19),s=r(1),i=r(2),o=r(0);class c{constructor(){this.pub_edward=new Uint8Array([]),this.pub_curve=new Uint8Array([])}static new(e,t){const r=o.new_instance(c);return r.pub_edward=e,r.pub_curve=t,r}verify(e,t){return s.crypto_sign_verify_detached(e,t,this.pub_edward)}fingerprint(){return s.to_hex(this.pub_edward)}encode(e){return e.object(1),e.u8(0),e.bytes(this.pub_edward)}static decode(e){const t=o.new_instance(c),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.pub_edward=new Uint8Array(e.bytes());break;default:e.skip()}const s=n.convertPublicKey(t.pub_edward);if(s)return t.pub_curve=s,t;throw new i.InputError.ConversionError("Could not convert private key with ed2curve.",409)}}t.PublicKey=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e,t=1){super(e),this.message=e,this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}t.ProteusError=n,n.CODE={CASE_100:100,CASE_101:101,CASE_102:102,CASE_103:103,CASE_104:104}},function(e,t){e.exports=CBOR},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=r(19),i=r(1),o=r(0),c=r(3),a=r(20),u=r(2);class h{constructor(){this.public_key=new c.PublicKey,this.secret_key=new a.SecretKey}static new(){return n(this,void 0,void 0,(function*(){yield i.ready;const e=i.crypto_sign_keypair(),t=o.new_instance(h);return t.secret_key=h.prototype._construct_private_key(e),t.public_key=h.prototype._construct_public_key(e),t}))}_construct_private_key(e){const t=e.privateKey,r=s.convertSecretKey(t);if(r)return a.SecretKey.new(t,r);throw new u.InputError.ConversionError("Could not convert private key with ed2curve.",409)}_construct_public_key(e){const t=e.publicKey,r=s.convertPublicKey(t);if(r)return c.PublicKey.new(t,r);throw new u.InputError.ConversionError("Could not convert public key with ed2curve.",408)}encode(e){return e.object(2),e.u8(0),this.secret_key.encode(e),e.u8(1),this.public_key.encode(e)}static decode(e){const t=o.new_instance(h),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.secret_key=a.SecretKey.decode(e);break;case 1:t.public_key=c.PublicKey.decode(e);break;default:e.skip()}return t}}t.KeyPair=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.zeroize=function e(t){t instanceof Uint8Array?n.memzero(t):t instanceof ArrayBuffer?n.memzero(new Uint8Array(t)):"object"==typeof t&&Object.keys(t).map(e=>t[e]).forEach(t=>e(t))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),s=r(3);class i{constructor(){this.public_key=new s.PublicKey}static new(e){const t=n.new_instance(i);return t.public_key=e,t}fingerprint(){return this.public_key.fingerprint()}encode(e){return e.object(1),e.u8(0),this.public_key.encode(e)}static decode(e){let t=n.new_instance(s.PublicKey);const r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t=s.PublicKey.decode(e);break;default:e.skip()}return i.new(t)}}t.IdentityKey=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),s=r(3),i=r(0),o=r(17),c=r(21);class a extends o.Message{constructor(){super(),this.cipher_text=new Uint8Array([]),this.counter=-1,this.prev_counter=-1,this.ratchet_key=new s.PublicKey,this.session_tag=new c.SessionTag}static new(e,t,r,n,s){const o=i.new_instance(a);return o.session_tag=e,o.counter=t,o.prev_counter=r,o.ratchet_key=n,o.cipher_text=s,Object.freeze(o),o}encode(e){return e.object(5),e.u8(0),this.session_tag.encode(e),e.u8(1),e.u32(this.counter),e.u8(2),e.u32(this.prev_counter),e.u8(3),this.ratchet_key.encode(e),e.u8(4),e.bytes(this.cipher_text)}static decode(e){let t=null,r=null,i=null,o=null,u=null;const h=e.object();for(let n=0;n<=h-1;n++)switch(e.u8()){case 0:t=c.SessionTag.decode(e);break;case 1:r=e.u32();break;case 2:i=e.u32();break;case 3:o=s.PublicKey.decode(e);break;case 4:u=new Uint8Array(e.bytes());break;default:e.skip()}if(r=Number(r),i=Number(i),t&&!isNaN(r)&&!isNaN(i)&&o&&u)return a.new(t,r,i,o,u);throw new n.InputError.TypeError("Given CipherMessage doesn't match expected signature.",n.InputError.CODE.CASE_405)}}t.CipherMessage=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12),s=r(14),i=r(0),o=r(22);class c{constructor(){this.idx=-1,this.key=new s.MacKey(new Uint8Array([]))}static from_mac_key(e,t){const r=i.new_instance(c);return r.key=e,r.idx=t,r}next(){const e=i.new_instance(c);return e.key=new s.MacKey(this.key.sign("1")),e.idx=this.idx+1,e}message_keys(){const e=this.key.sign("0"),t=n.DerivedSecrets.kdf_without_salt(e,"hash_ratchet");return o.MessageKeys.new(t.cipher_key,t.mac_key,this.idx)}encode(e){return e.object(2),e.u8(0),this.key.encode(e),e.u8(1),e.u32(this.idx)}static decode(e){const t=i.new_instance(c),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.key=s.MacKey.decode(e);break;case 1:t.idx=e.u32();break;default:e.skip()}return t}}t.ChainKey=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),s=r(0);class i{constructor(){this.key=new Uint8Array([])}static new(e){const t=s.new_instance(i);return t.key=e,t}encrypt(e,t){return e instanceof ArrayBuffer&&void 0!==e.byteLength&&(e=new Uint8Array(e)),n.crypto_stream_chacha20_xor(e,t,this.key,"uint8array")}decrypt(e,t){return this.encrypt(e,t)}encode(e){return e.object(1),e.u8(0),e.bytes(this.key)}static decode(e){let t=new Uint8Array([]);const r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t=new Uint8Array(e.bytes());break;default:e.skip()}return i.new(t)}}t.CipherKey=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),s=r(23),i=r(7),o=r(11),c=r(14);class a{constructor(){this.cipher_key=new o.CipherKey,this.mac_key=new c.MacKey(new Uint8Array([]))}static kdf(e,t,r){const u=s.hkdf(t,e,r,64),h=new Uint8Array(u.buffer.slice(0,32)),y=new Uint8Array(u.buffer.slice(32,64));i.zeroize(u.buffer);const _=n.new_instance(a);return _.cipher_key=o.CipherKey.new(h),_.mac_key=new c.MacKey(y),_}static kdf_without_salt(e,t){return this.kdf(e,new Uint8Array(0),t)}}t.DerivedSecrets=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);t.assert_is_not_zeros=function(e){let t=!0;for(const r of e)if(r>0){t=!1;break}if(!0===t)throw new n.ProteusError("Array consists only of zeros",n.ProteusError.CODE.CASE_100)},t.concatenate_array_buffers=function(e){return e.reduce((e,t)=>{const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);class s{constructor(e){this.key=e}sign(e){return n.crypto_auth_hmacsha256(e,this.key)}verify(e,t){return n.crypto_auth_hmacsha256_verify(e,t,this.key)}encode(e){return e.object(1),e.u8(0),e.bytes(this.key)}static decode(e){let t=new Uint8Array([]);const r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t=new Uint8Array(e.bytes());break;default:e.skip()}return new s(t)}}t.MacKey=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);class s extends n.ProteusError{constructor(e="Unknown decoding error",t=3){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}}t.DecodeError=s,s.CODE={CASE_300:300,CASE_301:301,CASE_302:302,CASE_303:303},function(e){e.InvalidType=class extends e{constructor(e="Invalid type",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.InvalidArrayLen=class extends e{constructor(e="Invalid array length",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.LocalIdentityChanged=class extends e{constructor(e="Local identity changed",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}}}(s=t.DecodeError||(t.DecodeError={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);class s extends n.ProteusError{constructor(e="Unknown decryption error",t=2){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}}t.DecryptError=s,s.CODE={CASE_200:200,CASE_201:201,CASE_202:202,CASE_203:203,CASE_204:204,CASE_205:205,CASE_206:206,CASE_207:207,CASE_208:208,CASE_209:209,CASE_210:210,CASE_211:211,CASE_212:212,CASE_213:213},function(e){e.DuplicateMessage=class extends e{constructor(t="Duplicate message",r=e.CODE.CASE_209){super(t,r),Object.setPrototypeOf(this,new.target.prototype)}};e.InvalidMessage=class extends e{constructor(e="Invalid message",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.InvalidSignature=class extends e{constructor(e="Invalid signature",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.OutdatedMessage=class extends e{constructor(t="Outdated message",r=e.CODE.CASE_208){super(t,r),Object.setPrototypeOf(this,new.target.prototype)}};e.PrekeyNotFound=class extends e{constructor(e="Pre-key not found",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.RemoteIdentityChanged=class extends e{constructor(e="Remote identity changed",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}};e.RemoteEncryptionError=class extends e{constructor(t="Sending client failed to encrypt the message",r=e.CODE.CASE_213){super(t,r),Object.setPrototypeOf(this,new.target.prototype)}};e.TooDistantFuture=class extends e{constructor(e="Message is from too distant in the future",t){super(e,t),Object.setPrototypeOf(this,new.target.prototype)}}}(s=t.DecryptError||(t.DecryptError={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),s=r(15);t.Message=class{constructor(){}serialise(){const e=new n.Encoder;if(this instanceof i.CipherMessage)e.u8(1);else{if(!(this instanceof o.PreKeyMessage))throw new TypeError("Unexpected message type");e.u8(2)}return this.encode(e),e.get_buffer()}static deserialise(e){const t=new n.Decoder(e);switch(t.u8()){case 1:return i.CipherMessage.decode(t);case 2:return o.PreKeyMessage.decode(t);default:throw new s.DecodeError.InvalidType("Unrecognised message type",s.DecodeError.CODE.CASE_302)}}};const i=r(9),o=r(18)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(8),s=r(3),i=r(0),o=r(2),c=r(9),a=r(17);class u extends a.Message{constructor(){super(),this.base_key=new s.PublicKey,this.identity_key=new n.IdentityKey,this.message=new c.CipherMessage,this.prekey_id=-1}static new(e,t,r,n){const s=i.new_instance(u);return s.prekey_id=e,s.base_key=t,s.identity_key=r,s.message=n,Object.freeze(s),s}encode(e){return e.object(4),e.u8(0),e.u16(this.prekey_id),e.u8(1),this.base_key.encode(e),e.u8(2),this.identity_key.encode(e),e.u8(3),this.message.encode(e)}static decode(e){let t=null,r=null,i=null,a=null;const h=e.object();for(let o=0;o<=h-1;o++)switch(e.u8()){case 0:t=e.u16();break;case 1:r=s.PublicKey.decode(e);break;case 2:i=n.IdentityKey.decode(e);break;case 3:a=c.CipherMessage.decode(e);break;default:e.skip()}if(t=Number(t),!isNaN(t)&&r&&i&&a)return u.new(t,r,i,a);throw new o.InputError.TypeError("Given PreKeyMessage doesn't match expected signature.",o.InputError.CODE.CASE_406)}}t.PreKeyMessage=u},function(e,t,r){!function(t,n){"use strict";e.exports?e.exports=n(r(38)):t.ed2curve=n(t.nacl)}(this,(function(e){"use strict";if(!e)throw new Error("tweetnacl not loaded");var t=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},r=t(),n=t([1]),s=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),i=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function o(e){var t,r;for(r=0;r<16;r++)e[r]+=65536,t=Math.floor(e[r]/65536),e[(r+1)*(r<15?1:0)]+=t-1+37*(t-1)*(15===r?1:0),e[r]-=65536*t}function c(e,t,r){for(var n,s=~(r-1),i=0;i<16;i++)n=s&(e[i]^t[i]),e[i]^=n,t[i]^=n}function a(e,t,r){var n;for(n=0;n<16;n++)e[n]=t[n]+r[n]|0}function u(e,t,r){var n;for(n=0;n<16;n++)e[n]=t[n]-r[n]|0}function h(e,t,r){var n,s,i=new Float64Array(31);for(n=0;n<31;n++)i[n]=0;for(n=0;n<16;n++)for(s=0;s<16;s++)i[n+s]+=t[n]*r[s];for(n=0;n<15;n++)i[n]+=38*i[n+16];for(n=0;n<16;n++)e[n]=i[n];o(e),o(e)}function y(e,t){h(e,t,t)}function _(e,r){var n,s,i,a=t(),u=t();for(n=0;n<16;n++)u[n]=r[n];for(o(u),o(u),o(u),s=0;s<2;s++){for(a[0]=u[0]-65517,n=1;n<15;n++)a[n]=u[n]-65535-(a[n-1]>>16&1),a[n-1]&=65535;a[15]=u[15]-32767-(a[14]>>16&1),i=a[15]>>16&1,a[14]&=65535,c(u,a,1-i)}for(n=0;n<16;n++)e[2*n]=255&u[n],e[2*n+1]=u[n]>>8}function d(e,t){var r=new Uint8Array(32),n=new Uint8Array(32);return _(r,e),_(n,t),function(e,t,r,n,s){var i,o=0;for(i=0;i<s;i++)o|=e[t+i]^r[n+i];return(1&o-1>>>8)-1}(r,0,n,0,32)}function f(e,o){var c,f,l=t(),p=t(),w=t(),b=t(),v=t(),k=t(),g=t();return function(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}(e[2],n),function(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(e[1],o),y(w,e[1]),h(b,w,s),u(w,w,e[2]),a(b,e[2],b),y(v,b),y(k,v),h(g,k,v),h(l,g,w),h(l,l,b),function(e,r){var n,s=t();for(n=0;n<16;n++)s[n]=r[n];for(n=250;n>=0;n--)y(s,s),1!==n&&h(s,s,r);for(n=0;n<16;n++)e[n]=s[n]}(l,l),h(l,l,w),h(l,l,b),h(l,l,b),h(e[0],l,b),y(p,e[0]),h(p,p,b),d(p,w)&&h(e[0],e[0],i),y(p,e[0]),h(p,p,b),d(p,w)?-1:(c=e[0],_(f=new Uint8Array(32),c),(1&f[0])==o[31]>>7&&u(e[0],r,e[0]),h(e[3],e[0],e[1]),0)}function l(e){var r=new Uint8Array(32),s=[t(),t(),t(),t()],i=t(),o=t();if(f(s,e))return null;var c=s[1];return a(i,n,c),u(o,n,c),function(e,r){var n,s=t();for(n=0;n<16;n++)s[n]=r[n];for(n=253;n>=0;n--)y(s,s),2!==n&&4!==n&&h(s,s,r);for(n=0;n<16;n++)e[n]=s[n]}(o,o),h(i,i,o),_(r,i),r}function p(t){var r,n=new Uint8Array(64),s=new Uint8Array(32);for(e.lowlevel.crypto_hash(n,t,32),n[0]&=248,n[31]&=127,n[31]|=64,r=0;r<32;r++)s[r]=n[r];for(r=0;r<64;r++)n[r]=0;return s}return{convertPublicKey:l,convertSecretKey:p,convertKeyPair:function(e){var t=l(e.publicKey);return t?{publicKey:t,secretKey:p(e.secretKey)}:null}}}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(19),s=r(1),i=r(0),o=r(2),c=r(13);class a{constructor(){this.sec_curve=new Uint8Array([]),this.sec_edward=new Uint8Array([])}static new(e,t){const r=i.new_instance(a);return r.sec_edward=e,r.sec_curve=t,r}sign(e){return s.crypto_sign_detached(e,this.sec_edward)}shared_secret(e){const t=s.crypto_scalarmult(this.sec_curve,e.pub_curve);return c.assert_is_not_zeros(t),t}encode(e){return e.object(1),e.u8(0),e.bytes(this.sec_edward)}static decode(e){const t=i.new_instance(a),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.sec_edward=new Uint8Array(e.bytes());break;default:e.skip()}const s=n.convertSecretKey(t.sec_edward);if(s)return t.sec_curve=s,t;throw new o.InputError.ConversionError("Could not convert public key with ed2curve.",408)}}t.SecretKey=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),s=r(15),i=r(0),o=r(27);class c{constructor(){this.tag=new Uint8Array([])}static new(){const e=i.new_instance(c);return e.tag=o.random_bytes(16),e}toString(){return n.to_hex(this.tag)}encode(e){return e.bytes(this.tag)}static decode(e){const t=new Uint8Array(e.bytes());if(16!==t.byteLength)throw new s.DecodeError.InvalidArrayLen(`Session tag should be 16 bytes, not ${t.byteLength} bytes.`,s.DecodeError.CODE.CASE_303);const r=i.new_instance(c);return r.tag=new Uint8Array(t),r}}t.SessionTag=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(11),s=r(14),i=r(0);class o{constructor(){this.cipher_key=new n.CipherKey,this.counter=-1,this.mac_key=new s.MacKey(new Uint8Array([]))}static new(e,t,r){const n=i.new_instance(o);return n.cipher_key=e,n.mac_key=t,n.counter=r,n}_counter_as_nonce(){const e=new ArrayBuffer(8);return new DataView(e).setUint32(0,this.counter),new Uint8Array(e)}encrypt(e){return this.cipher_key.encrypt(e,this._counter_as_nonce())}decrypt(e){return this.cipher_key.decrypt(e,this._counter_as_nonce())}encode(e){return e.object(3),e.u8(0),this.cipher_key.encode(e),e.u8(1),this.mac_key.encode(e),e.u8(2),e.u32(this.counter)}static decode(e){const t=i.new_instance(o),r=e.object();for(let i=0;i<=r-1;i++)switch(e.u8()){case 0:t.cipher_key=n.CipherKey.decode(e);break;case 1:t.mac_key=s.MacKey.decode(e);break;case 2:t.counter=e.u32();break;default:e.skip()}return t}}t.MessageKeys=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),s=r(13),i=r(7);t.hkdf=function(e,t,r,o){const c=e=>"string"==typeof e?n.from_string(e):e;e=c(e),t=c(t),r=c(r);const a=((e,t)=>n.crypto_auth_hmacsha256(t,(e=>{const t=n.crypto_auth_hmacsha256_KEYBYTES;if(e.length>t)return n.crypto_hash_sha256(e);const r=new Uint8Array(t);return r.set(e),r})(e)))(e,t);return i.zeroize(t),i.zeroize(e),((e,t,r)=>{const i=Math.ceil(r/32);let o=new Uint8Array(0),c=new Uint8Array(0);for(let r=0;r<=i-1;r++){const i=s.concatenate_array_buffers([o,t,new Uint8Array([r+1])]);o=n.crypto_auth_hmacsha256(i,e),c=s.concatenate_array_buffers([c,o])}return new Uint8Array(c.buffer.slice(0,r))})(a,r,o)}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(0),o=r(8),c=r(6),a=r(20);class u{constructor(){this.public_key=new o.IdentityKey,this.secret_key=new a.SecretKey,this.version=-1}static new(){return n(this,void 0,void 0,(function*(){const e=yield c.KeyPair.new(),t=i.new_instance(u);return t.version=1,t.secret_key=e.secret_key,t.public_key=o.IdentityKey.new(e.public_key),t}))}serialise(){const e=new s.Encoder;return this.encode(e),e.get_buffer()}static deserialise(e){const t=new s.Decoder(e);return u.decode(t)}encode(e){return e.object(3),e.u8(0),e.u8(this.version),e.u8(1),this.secret_key.encode(e),e.u8(2),this.public_key.encode(e)}static decode(e){const t=i.new_instance(u),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.version=e.u8();break;case 1:t.secret_key=a.SecretKey.decode(e);break;case 2:t.public_key=o.IdentityKey.decode(e);break;default:e.skip()}return t}}t.IdentityKeyPair=u},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(0),o=r(2),c=r(6);class a{constructor(){this.key_id=-1,this.key_pair=new c.KeyPair,this.version=-1}static new(e){return n(this,void 0,void 0,(function*(){this.validate_pre_key_id(e);const t=i.new_instance(a);return t.version=1,t.key_id=e,t.key_pair=yield c.KeyPair.new(),t}))}static validate_pre_key_id(e){if(void 0===e)throw new o.InputError.TypeError("PreKey ID is undefined.",o.InputError.CODE.CASE_404);if("string"==typeof e)throw new o.InputError.TypeError(`PreKey ID "${e}" is a string.`,o.InputError.CODE.CASE_403);if(e%1!=0)throw new o.InputError.TypeError(`PreKey ID "${e}" is a floating-point number.`,o.InputError.CODE.CASE_403);if(e<0||e>a.MAX_PREKEY_ID){const t=`PreKey ID (${e}) must be between or equal to 0 and ${a.MAX_PREKEY_ID}.`;throw new o.InputError.RangeError(t,o.InputError.CODE.CASE_400)}}static last_resort(){return a.new(a.MAX_PREKEY_ID)}static generate_prekeys(e,t){return n(this,void 0,void 0,(function*(){return this.validate_pre_key_id(e),this.validate_pre_key_id(t),0===t?[]:Promise.all(Array.from({length:t}).map((t,r)=>a.new((e+r)%a.MAX_PREKEY_ID)))}))}serialise(){const e=new s.Encoder;return this.encode(e),e.get_buffer()}static deserialise(e){return a.decode(new s.Decoder(e))}encode(e){return e.object(3),e.u8(0),e.u8(this.version),e.u8(1),e.u16(this.key_id),e.u8(2),this.key_pair.encode(e)}static decode(e){const t=i.new_instance(a),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.version=e.u8();break;case 1:t.key_id=e.u16();break;case 2:t.key_pair=c.KeyPair.decode(e);break;default:e.skip()}return t}}t.PreKey=a,a.MAX_PREKEY_ID=65535},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{}t.PreKeyAuth=n,n.INVALID="Invalid",n.UNKNOWN="Unknown",n.VALID="Valid"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.random_bytes=e=>{if("undefined"!=typeof window&&window.crypto){const t=new ArrayBuffer(e),r=new Uint8Array(t);return window.crypto.getRandomValues(r)}const t=r(42);return new Uint8Array(t.randomBytes(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),s=r(0),i=r(17);class o{constructor(){this._message_enc=new Uint8Array([]),this.mac=new Uint8Array([]),this.message=new i.Message,this.version=-1}static new(e,t){const r=new Uint8Array(t.serialise()),n=s.new_instance(o);return n.version=1,n.mac=e.sign(r),n.message=t,n._message_enc=r,Object.freeze(n),n}verify(e){return e.verify(this.mac,this._message_enc)}serialise(){const e=new n.Encoder;return this.encode(e),e.get_buffer()}static deserialise(e){const t=new n.Decoder(e);return o.decode(t)}encode(e){return e.object(3),e.u8(0),e.u8(this.version),e.u8(1),e.object(1),e.u8(0),e.bytes(this.mac),e.u8(2),e.bytes(this._message_enc)}static decode(e){const t=s.new_instance(o),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.version=e.u8();break;case 1:{const r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.mac=new Uint8Array(e.bytes());break;default:e.skip()}break}case 2:t._message_enc=new Uint8Array(e.bytes());break;default:e.skip()}return t.message=i.Message.deserialise(t._message_enc.buffer),Object.freeze(t),t}}t.Envelope=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),s=r(0),i=r(16),o=r(4),c=r(10),a=r(22);class u{constructor(){this.chain_key=new c.ChainKey,this.message_keys=[],this.ratchet_key=new n.PublicKey}static new(e,t){const r=s.new_instance(u);return r.chain_key=e,r.ratchet_key=t,r.message_keys=[],r}try_message_keys(e,t){var r;if((null===(r=this.message_keys[0])||void 0===r?void 0:r.counter)>t.counter){const e=`Message too old. Counter for oldest staged chain key is '${this.message_keys[0].counter}' while message counter is '${t.counter}'.`;throw new i.DecryptError.OutdatedMessage(e,i.DecryptError.CODE.CASE_208)}const n=this.message_keys.findIndex(e=>e.counter===t.counter);if(-1===n)throw new i.DecryptError.DuplicateMessage(void 0,i.DecryptError.CODE.CASE_209);const s=this.message_keys.splice(n,1)[0];if(!e.verify(s.mac_key)){const e=`Envelope verification failed for message with counter behind. Message index is '${t.counter}' while receive chain index is '${this.chain_key.idx}'.`;throw new i.DecryptError.InvalidSignature(e,i.DecryptError.CODE.CASE_210)}return s.decrypt(t.cipher_text)}stage_message_keys(e){const t=e.counter-this.chain_key.idx;if(t>u.MAX_COUNTER_GAP){if(0===this.chain_key.idx)throw new i.DecryptError.TooDistantFuture("Skipped too many messages at the beginning of a receive chain.",i.DecryptError.CODE.CASE_211);throw new i.DecryptError.TooDistantFuture(`Skipped too many messages within a used receive chain. Receive chain counter is '${this.chain_key.idx}'`,i.DecryptError.CODE.CASE_212)}const r=[];let n=this.chain_key;for(let e=0;e<=t-1;e++)r.push(n.message_keys()),n=n.next();const s=n.message_keys();return[n,s,r]}commit_message_keys(e){if(e.length>u.MAX_COUNTER_GAP)throw new o.ProteusError(`Number of message keys (${e.length}) exceed message chain counter gap (${u.MAX_COUNTER_GAP}).`,o.ProteusError.CODE.CASE_103);const t=this.message_keys.length+e.length-u.MAX_COUNTER_GAP;for(let e=0;e<=t-1;e++)this.message_keys.shift();if(e.map(e=>this.message_keys.push(e)),e.length>u.MAX_COUNTER_GAP)throw new o.ProteusError(`Skipped message keys which exceed the message chain counter gap (${u.MAX_COUNTER_GAP}).`,o.ProteusError.CODE.CASE_104)}encode(e){return e.object(3),e.u8(0),this.chain_key.encode(e),e.u8(1),this.ratchet_key.encode(e),e.u8(2),e.array(this.message_keys.length),this.message_keys.map(t=>t.encode(e))}static decode(e){const t=s.new_instance(u),r=e.object();for(let s=0;s<=r-1;s++)switch(e.u8()){case 0:t.chain_key=c.ChainKey.decode(e);break;case 1:t.ratchet_key=n.PublicKey.decode(e);break;case 2:{t.message_keys=[];let r=e.array();for(;r--;)t.message_keys.push(a.MessageKeys.decode(e));break}default:e.skip()}return t}}t.RecvChain=u,u.MAX_COUNTER_GAP=1e3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(11),s=r(12),i=r(2),o=r(0),c=r(10);class a{constructor(){this.key=new n.CipherKey}static from_cipher_key(e){const t=o.new_instance(a);return t.key=e,t}dh_ratchet(e,t){const r=e.secret_key.shared_secret(t),n=s.DerivedSecrets.kdf(r,this.key.key,"dh_ratchet");return[a.from_cipher_key(n.cipher_key),c.ChainKey.from_mac_key(n.mac_key,0)]}encode(e){return e.object(1),e.u8(0),this.key.encode(e)}static decode(e){let t=null;const r=e.object();for(let s=0;s<=r-1;s++)switch(e.u8()){case 0:t=n.CipherKey.decode(e);break;default:e.skip()}if(t)return a.from_cipher_key(t);throw new i.InputError.TypeError("Given RootKey doesn't match expected signature.",i.InputError.CODE.CASE_407)}}t.RootKey=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),s=r(0),i=r(10);class o{constructor(){this.chain_key=new i.ChainKey,this.ratchet_key=new n.KeyPair}static new(e,t){const r=s.new_instance(o);return r.chain_key=e,r.ratchet_key=t,r}encode(e){return e.object(2),e.u8(0),this.chain_key.encode(e),e.u8(1),this.ratchet_key.encode(e)}static decode(e){const t=s.new_instance(o),r=e.object();for(let s=0;s<=r-1;s++)switch(e.u8()){case 0:t.chain_key=i.ChainKey.decode(e);break;case 1:t.ratchet_key=n.KeyPair.decode(e);break;default:e.skip()}return t}}t.SendChain=o},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(0),o=r(7),c=r(15),a=r(16),u=r(4),h=r(33),y=r(8),_=r(24),d=r(6),f=r(25),l=r(3),p=r(9),w=r(18),b=r(21);class v{constructor(){this.counter=0,this.version=1,this.local_identity=new _.IdentityKeyPair,this.pending_prekey=null,this.remote_identity=new y.IdentityKey,this.session_states={},this.session_tag=new b.SessionTag}static init_from_prekey(e,t){return n(this,void 0,void 0,(function*(){const r=yield d.KeyPair.new(),n=yield h.SessionState.init_as_alice(e,r,t),s=b.SessionTag.new(),o=i.new_instance(this);return o.session_tag=s,o.local_identity=e,o.remote_identity=t.identity_key,o.pending_prekey=[t.prekey_id,r.public_key],o.session_states={},o._insert_session_state(s,n),o}))}static init_from_message(e,t,r){return n(this,void 0,void 0,(function*(){const n=r.message;if(n instanceof p.CipherMessage)throw new a.DecryptError.InvalidMessage("Can't initialise a session from a CipherMessage.",a.DecryptError.CODE.CASE_201);if(n instanceof w.PreKeyMessage){const s=i.new_instance(v);s.session_tag=n.message.session_tag,s.local_identity=e,s.remote_identity=n.identity_key,s.pending_prekey=null,s.session_states={};const c=yield s._new_state(t,n),u=yield c.decrypt(r,n.message);if(s._insert_session_state(n.message.session_tag,c),n.prekey_id<f.PreKey.MAX_PREKEY_ID){o.zeroize(yield t.load_prekey(n.prekey_id));try{yield t.delete_prekey(n.prekey_id)}catch(e){throw new a.DecryptError.PrekeyNotFound(`Could not delete PreKey: ${e.message}`,a.DecryptError.CODE.CASE_203)}}return[s,u]}throw new a.DecryptError.InvalidMessage('Unknown message format: The message is neither a "CipherMessage" nor a "PreKeyMessage".',a.DecryptError.CODE.CASE_202)}))}_new_state(e,t){return n(this,void 0,void 0,(function*(){const r=yield e.load_prekey(t.prekey_id);if(r)return h.SessionState.init_as_bob(this.local_identity,r.key_pair,t.identity_key,t.base_key);throw new u.ProteusError(`Unable to find PreKey ID "${t.prekey_id}" in PreKey store "${e.constructor.name}".`,u.ProteusError.CODE.CASE_101)}))}_insert_session_state(e,t){this.session_states.hasOwnProperty(e.toString())?this.session_states[e.toString()].state=t:(this.counter>=Number.MAX_SAFE_INTEGER&&(this.session_states={},this.counter=0),this.session_states[e.toString()]={idx:this.counter,state:t,tag:e},this.counter++),this.session_tag.toString()!==e.toString()&&(this.session_tag=e);if(!((e=>Object.keys(e).length)(this.session_states)<v.MAX_SESSION_STATES))return this._evict_oldest_session_state()}_evict_oldest_session_state(){const e=Object.keys(this.session_states).filter(e=>e.toString()!==this.session_tag.toString()).reduce((e,t,r)=>this.session_states[t].idx<this.session_states[e].idx?t.toString():e);o.zeroize(this.session_states[e]),delete this.session_states[e]}get_local_identity(){return this.local_identity.public_key}encrypt(e){return n(this,void 0,void 0,(function*(){const t=this.session_states[this.session_tag.toString()];if(!t)throw new u.ProteusError(`Could not find session for tag '${(this.session_tag||"").toString()}'.`,u.ProteusError.CODE.CASE_102);return t.state.encrypt(this.local_identity.public_key,this.pending_prekey,this.session_tag,e)}))}decrypt(e,t){return n(this,void 0,void 0,(function*(){const r=t.message;if(r instanceof p.CipherMessage)return this._decrypt_cipher_message(t,r);if(r instanceof w.PreKeyMessage){const n=r.identity_key.fingerprint(),s=this.remote_identity.fingerprint();if(n!==s){const e=`Fingerprints do not match: We expected '${s}', but received '${n}'.`;throw new a.DecryptError.RemoteIdentityChanged(e,a.DecryptError.CODE.CASE_204)}return this._decrypt_prekey_message(t,r,e)}throw new a.DecryptError("Unknown message type.",a.DecryptError.CODE.CASE_200)}))}_decrypt_prekey_message(e,t,r){return n(this,void 0,void 0,(function*(){try{return yield this._decrypt_cipher_message(e,t.message)}catch(n){if(n instanceof a.DecryptError.InvalidSignature||n instanceof a.DecryptError.InvalidMessage){const n=yield this._new_state(r,t),s=yield n.decrypt(e,t.message);return t.prekey_id!==f.PreKey.MAX_PREKEY_ID&&(o.zeroize(yield r.load_prekey(t.prekey_id)),yield r.delete_prekey(t.prekey_id)),this._insert_session_state(t.message.session_tag,n),this.pending_prekey=null,s}throw n}}))}_decrypt_cipher_message(e,t){return n(this,void 0,void 0,(function*(){const r=this.session_states[t.session_tag.toString()];if(!r)throw new a.DecryptError.InvalidMessage(`Local session not found for message session tag '${t.session_tag}'.`,a.DecryptError.CODE.CASE_205);const n=h.SessionState.deserialise(r.state.serialise()),s=yield n.decrypt(e,t);return this.pending_prekey=null,this._insert_session_state(t.session_tag,n),s}))}serialise(){const e=new s.Encoder;return this.encode(e),e.get_buffer()}static deserialise(e,t){const r=new s.Decoder(t);return this.decode(e,r)}encode(e){e.object(6),e.u8(0),e.u8(this.version),e.u8(1),this.session_tag.encode(e),e.u8(2),this.local_identity.public_key.encode(e),e.u8(3),this.remote_identity.encode(e),e.u8(4),this.pending_prekey?(e.object(2),e.u8(0),e.u16(this.pending_prekey[0]),e.u8(1),this.pending_prekey[1].encode(e)):e.null(),e.u8(5),e.object(Object.keys(this.session_states).length);for(const t in this.session_states){const r=this.session_states[t];r.tag.encode(e),r.state.encode(e)}}static decode(e,t){const r=i.new_instance(this),n=t.object();for(let s=0;s<=n-1;s++)switch(t.u8()){case 0:r.version=t.u8();break;case 1:r.session_tag=b.SessionTag.decode(t);break;case 2:{const n=y.IdentityKey.decode(t);if(e.public_key.fingerprint()!==n.fingerprint())throw new c.DecodeError.LocalIdentityChanged(void 0,c.DecodeError.CODE.CASE_300);r.local_identity=e;break}case 3:r.remote_identity=y.IdentityKey.decode(t);break;case 4:switch(t.optional(()=>t.object())){case null:r.pending_prekey=null;break;case 2:r.pending_prekey=[];for(let e=0;e<=1;++e)switch(t.u8()){case 0:r.pending_prekey[0]=t.u16();break;case 1:r.pending_prekey[1]=l.PublicKey.decode(t)}break;default:throw new c.DecodeError.InvalidType(void 0,c.DecodeError.CODE.CASE_301)}break;case 5:{r.session_states={};const e=t.object();for(let n=0;n<=e-1;n++){const e=b.SessionTag.decode(t);r.session_states[e.toString()]={idx:n,state:h.SessionState.decode(t),tag:e}}break}default:t.skip()}return r}}t.Session=v,v.MAX_RECV_CHAINS=5,v.MAX_SESSION_STATES=100},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=r(5),i=r(13),o=r(0),c=r(7),a=r(16),u=r(12),h=r(6),y=r(9),_=r(28),d=r(18),f=r(10),l=r(29),p=r(30),w=r(31),b=r(32);class v{constructor(){this.prev_counter=-1,this.recv_chains=[],this.root_key=new p.RootKey,this.send_chain=new w.SendChain}static init_as_alice(e,t,r){return n(this,void 0,void 0,(function*(){const n=i.concatenate_array_buffers([e.secret_key.shared_secret(r.public_key),t.secret_key.shared_secret(r.identity_key.public_key),t.secret_key.shared_secret(r.public_key)]),s=u.DerivedSecrets.kdf_without_salt(n,"handshake");c.zeroize(n);const a=p.RootKey.from_cipher_key(s.cipher_key),y=f.ChainKey.from_mac_key(s.mac_key,0),_=[l.RecvChain.new(y,r.public_key)],d=yield h.KeyPair.new(),[b,k]=a.dh_ratchet(d,r.public_key),g=w.SendChain.new(k,d),E=o.new_instance(v);return E.recv_chains=_,E.send_chain=g,E.root_key=b,E.prev_counter=0,E}))}static init_as_bob(e,t,r,n){const s=i.concatenate_array_buffers([t.secret_key.shared_secret(r.public_key),e.secret_key.shared_secret(n),t.secret_key.shared_secret(n)]),a=u.DerivedSecrets.kdf_without_salt(s,"handshake");c.zeroize(s);const h=p.RootKey.from_cipher_key(a.cipher_key),y=f.ChainKey.from_mac_key(a.mac_key,0),_=w.SendChain.new(y,t),d=o.new_instance(v);return d.recv_chains=[],d.send_chain=_,d.root_key=h,d.prev_counter=0,d}ratchet(e){return n(this,void 0,void 0,(function*(){const t=yield h.KeyPair.new(),[r,n]=this.root_key.dh_ratchet(this.send_chain.ratchet_key,e),[s,i]=r.dh_ratchet(t,e),o=l.RecvChain.new(n,e),a=w.SendChain.new(i,t);if(this.root_key=s,this.prev_counter=this.send_chain.chain_key.idx,this.send_chain=a,this.recv_chains.unshift(o),this.recv_chains.length>b.Session.MAX_RECV_CHAINS){for(let e=b.Session.MAX_RECV_CHAINS;e<this.recv_chains.length;e++)c.zeroize(this.recv_chains[e]);this.recv_chains=this.recv_chains.slice(0,b.Session.MAX_RECV_CHAINS)}}))}encrypt(e,t,r,n){const s=this.send_chain.chain_key.message_keys();let i=y.CipherMessage.new(r,this.send_chain.chain_key.idx,this.prev_counter,this.send_chain.ratchet_key.public_key,s.encrypt(n));t&&(i=d.PreKeyMessage.new(t[0],t[1],e,i));const o=_.Envelope.new(s.mac_key,i);return this.send_chain.chain_key=this.send_chain.chain_key.next(),o}decrypt(e,t){return n(this,void 0,void 0,(function*(){let r=this.recv_chains.findIndex(e=>e.ratchet_key.fingerprint()===t.ratchet_key.fingerprint());-1===r&&(yield this.ratchet(t.ratchet_key),r=0);const n=this.recv_chains[r];if(t.counter<n.chain_key.idx)return n.try_message_keys(e,t);if(t.counter==n.chain_key.idx){const r=n.chain_key.message_keys();if(!e.verify(r.mac_key))throw new a.DecryptError.InvalidSignature(`Envelope verification failed for message with counters in sync at '${t.counter}'. The received message was possibly encrypted for another client.`,a.DecryptError.CODE.CASE_206);const s=r.decrypt(t.cipher_text);return n.chain_key=n.chain_key.next(),s}const[s,i,o]=n.stage_message_keys(t);if(!e.verify(i.mac_key))throw new a.DecryptError.InvalidSignature(`Envelope verification failed for message with counter ahead. Message index is '${t.counter}' while receive chain index is '${n.chain_key.idx}'.`,a.DecryptError.CODE.CASE_207);const c=i.decrypt(t.cipher_text);return n.chain_key=s.next(),n.commit_message_keys(o),c}))}serialise(){const e=new s.Encoder;return this.encode(e),e.get_buffer()}static deserialise(e){return v.decode(new s.Decoder(e))}encode(e){return e.object(4),e.u8(0),e.array(this.recv_chains.length),this.recv_chains.map(t=>t.encode(e)),e.u8(1),this.send_chain.encode(e),e.u8(2),this.root_key.encode(e),e.u8(3),e.u32(this.prev_counter)}static decode(e){const t=o.new_instance(v),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:{t.recv_chains=[];let r=e.array();for(;r--;)t.recv_chains.push(l.RecvChain.decode(e));break}case 1:t.send_chain=w.SendChain.decode(e);break;case 2:t.root_key=p.RootKey.decode(e);break;case 3:t.prev_counter=e.u32();break;default:e.skip()}return t}}t.SessionState=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(35);t.derived=n;const s=r(36);t.errors=s;const i=r(37);t.keys=i;const o=r(41);t.message=o;const c=r(43);t.session=c;const a=r(45);t.util=a},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(11)),n(r(12)),n(r(14))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(15)),n(r(16)),n(r(2)),n(r(4))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8);t.IdentityKey=n.IdentityKey;var s=r(24);t.IdentityKeyPair=s.IdentityKeyPair;var i=r(6);t.KeyPair=i.KeyPair;var o=r(25);t.PreKey=o.PreKey;var c=r(26);t.PreKeyAuth=c.PreKeyAuth;var a=r(40);t.PreKeyBundle=a.PreKeyBundle;var u=r(3);t.PublicKey=u.PublicKey;var h=r(20);t.SecretKey=h.SecretKey},function(e,t,r){!function(e){"use strict";var t=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},n=function(){throw new Error("no PRNG")},s=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),c=t([1]),a=t([56129,1]),u=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),h=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),y=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),_=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),d=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function f(e,t,r,n){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e[t+4]=n>>24&255,e[t+5]=n>>16&255,e[t+6]=n>>8&255,e[t+7]=255&n}function l(e,t,r,n,s){var i,o=0;for(i=0;i<s;i++)o|=e[t+i]^r[n+i];return(1&o-1>>>8)-1}function p(e,t,r,n){return l(e,t,r,n,16)}function w(e,t,r,n){return l(e,t,r,n,32)}function b(e,t,r,n){!function(e,t,r,n){for(var s,i=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,c=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,a=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,h=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,y=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,_=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,d=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,l=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,p=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,w=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,k=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,g=i,E=o,A=c,m=a,P=u,C=h,S=y,K=_,M=d,O=f,x=l,U=p,j=w,D=b,I=v,T=k,R=0;R<20;R+=2)g^=(s=(j^=(s=(M^=(s=(P^=(s=g+j|0)<<7|s>>>25)+g|0)<<9|s>>>23)+P|0)<<13|s>>>19)+M|0)<<18|s>>>14,C^=(s=(E^=(s=(D^=(s=(O^=(s=C+E|0)<<7|s>>>25)+C|0)<<9|s>>>23)+O|0)<<13|s>>>19)+D|0)<<18|s>>>14,x^=(s=(S^=(s=(A^=(s=(I^=(s=x+S|0)<<7|s>>>25)+x|0)<<9|s>>>23)+I|0)<<13|s>>>19)+A|0)<<18|s>>>14,T^=(s=(U^=(s=(K^=(s=(m^=(s=T+U|0)<<7|s>>>25)+T|0)<<9|s>>>23)+m|0)<<13|s>>>19)+K|0)<<18|s>>>14,g^=(s=(m^=(s=(A^=(s=(E^=(s=g+m|0)<<7|s>>>25)+g|0)<<9|s>>>23)+E|0)<<13|s>>>19)+A|0)<<18|s>>>14,C^=(s=(P^=(s=(K^=(s=(S^=(s=C+P|0)<<7|s>>>25)+C|0)<<9|s>>>23)+S|0)<<13|s>>>19)+K|0)<<18|s>>>14,x^=(s=(O^=(s=(M^=(s=(U^=(s=x+O|0)<<7|s>>>25)+x|0)<<9|s>>>23)+U|0)<<13|s>>>19)+M|0)<<18|s>>>14,T^=(s=(I^=(s=(D^=(s=(j^=(s=T+I|0)<<7|s>>>25)+T|0)<<9|s>>>23)+j|0)<<13|s>>>19)+D|0)<<18|s>>>14;g=g+i|0,E=E+o|0,A=A+c|0,m=m+a|0,P=P+u|0,C=C+h|0,S=S+y|0,K=K+_|0,M=M+d|0,O=O+f|0,x=x+l|0,U=U+p|0,j=j+w|0,D=D+b|0,I=I+v|0,T=T+k|0,e[0]=g>>>0&255,e[1]=g>>>8&255,e[2]=g>>>16&255,e[3]=g>>>24&255,e[4]=E>>>0&255,e[5]=E>>>8&255,e[6]=E>>>16&255,e[7]=E>>>24&255,e[8]=A>>>0&255,e[9]=A>>>8&255,e[10]=A>>>16&255,e[11]=A>>>24&255,e[12]=m>>>0&255,e[13]=m>>>8&255,e[14]=m>>>16&255,e[15]=m>>>24&255,e[16]=P>>>0&255,e[17]=P>>>8&255,e[18]=P>>>16&255,e[19]=P>>>24&255,e[20]=C>>>0&255,e[21]=C>>>8&255,e[22]=C>>>16&255,e[23]=C>>>24&255,e[24]=S>>>0&255,e[25]=S>>>8&255,e[26]=S>>>16&255,e[27]=S>>>24&255,e[28]=K>>>0&255,e[29]=K>>>8&255,e[30]=K>>>16&255,e[31]=K>>>24&255,e[32]=M>>>0&255,e[33]=M>>>8&255,e[34]=M>>>16&255,e[35]=M>>>24&255,e[36]=O>>>0&255,e[37]=O>>>8&255,e[38]=O>>>16&255,e[39]=O>>>24&255,e[40]=x>>>0&255,e[41]=x>>>8&255,e[42]=x>>>16&255,e[43]=x>>>24&255,e[44]=U>>>0&255,e[45]=U>>>8&255,e[46]=U>>>16&255,e[47]=U>>>24&255,e[48]=j>>>0&255,e[49]=j>>>8&255,e[50]=j>>>16&255,e[51]=j>>>24&255,e[52]=D>>>0&255,e[53]=D>>>8&255,e[54]=D>>>16&255,e[55]=D>>>24&255,e[56]=I>>>0&255,e[57]=I>>>8&255,e[58]=I>>>16&255,e[59]=I>>>24&255,e[60]=T>>>0&255,e[61]=T>>>8&255,e[62]=T>>>16&255,e[63]=T>>>24&255}(e,t,r,n)}function v(e,t,r,n){!function(e,t,r,n){for(var s,i=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,o=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,c=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,a=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,u=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,h=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,y=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,_=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,d=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,l=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,p=255&r[16]|(255&r[17])<<8|(255&r[18])<<16|(255&r[19])<<24,w=255&r[20]|(255&r[21])<<8|(255&r[22])<<16|(255&r[23])<<24,b=255&r[24]|(255&r[25])<<8|(255&r[26])<<16|(255&r[27])<<24,v=255&r[28]|(255&r[29])<<8|(255&r[30])<<16|(255&r[31])<<24,k=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,g=0;g<20;g+=2)i^=(s=(w^=(s=(d^=(s=(u^=(s=i+w|0)<<7|s>>>25)+i|0)<<9|s>>>23)+u|0)<<13|s>>>19)+d|0)<<18|s>>>14,h^=(s=(o^=(s=(b^=(s=(f^=(s=h+o|0)<<7|s>>>25)+h|0)<<9|s>>>23)+f|0)<<13|s>>>19)+b|0)<<18|s>>>14,l^=(s=(y^=(s=(c^=(s=(v^=(s=l+y|0)<<7|s>>>25)+l|0)<<9|s>>>23)+v|0)<<13|s>>>19)+c|0)<<18|s>>>14,k^=(s=(p^=(s=(_^=(s=(a^=(s=k+p|0)<<7|s>>>25)+k|0)<<9|s>>>23)+a|0)<<13|s>>>19)+_|0)<<18|s>>>14,i^=(s=(a^=(s=(c^=(s=(o^=(s=i+a|0)<<7|s>>>25)+i|0)<<9|s>>>23)+o|0)<<13|s>>>19)+c|0)<<18|s>>>14,h^=(s=(u^=(s=(_^=(s=(y^=(s=h+u|0)<<7|s>>>25)+h|0)<<9|s>>>23)+y|0)<<13|s>>>19)+_|0)<<18|s>>>14,l^=(s=(f^=(s=(d^=(s=(p^=(s=l+f|0)<<7|s>>>25)+l|0)<<9|s>>>23)+p|0)<<13|s>>>19)+d|0)<<18|s>>>14,k^=(s=(v^=(s=(b^=(s=(w^=(s=k+v|0)<<7|s>>>25)+k|0)<<9|s>>>23)+w|0)<<13|s>>>19)+b|0)<<18|s>>>14;e[0]=i>>>0&255,e[1]=i>>>8&255,e[2]=i>>>16&255,e[3]=i>>>24&255,e[4]=h>>>0&255,e[5]=h>>>8&255,e[6]=h>>>16&255,e[7]=h>>>24&255,e[8]=l>>>0&255,e[9]=l>>>8&255,e[10]=l>>>16&255,e[11]=l>>>24&255,e[12]=k>>>0&255,e[13]=k>>>8&255,e[14]=k>>>16&255,e[15]=k>>>24&255,e[16]=y>>>0&255,e[17]=y>>>8&255,e[18]=y>>>16&255,e[19]=y>>>24&255,e[20]=_>>>0&255,e[21]=_>>>8&255,e[22]=_>>>16&255,e[23]=_>>>24&255,e[24]=d>>>0&255,e[25]=d>>>8&255,e[26]=d>>>16&255,e[27]=d>>>24&255,e[28]=f>>>0&255,e[29]=f>>>8&255,e[30]=f>>>16&255,e[31]=f>>>24&255}(e,t,r,n)}var k=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function g(e,t,r,n,s,i,o){var c,a,u=new Uint8Array(16),h=new Uint8Array(64);for(a=0;a<16;a++)u[a]=0;for(a=0;a<8;a++)u[a]=i[a];for(;s>=64;){for(b(h,u,o,k),a=0;a<64;a++)e[t+a]=r[n+a]^h[a];for(c=1,a=8;a<16;a++)c=c+(255&u[a])|0,u[a]=255&c,c>>>=8;s-=64,t+=64,n+=64}if(s>0)for(b(h,u,o,k),a=0;a<s;a++)e[t+a]=r[n+a]^h[a];return 0}function E(e,t,r,n,s){var i,o,c=new Uint8Array(16),a=new Uint8Array(64);for(o=0;o<16;o++)c[o]=0;for(o=0;o<8;o++)c[o]=n[o];for(;r>=64;){for(b(a,c,s,k),o=0;o<64;o++)e[t+o]=a[o];for(i=1,o=8;o<16;o++)i=i+(255&c[o])|0,c[o]=255&i,i>>>=8;r-=64,t+=64}if(r>0)for(b(a,c,s,k),o=0;o<r;o++)e[t+o]=a[o];return 0}function A(e,t,r,n,s){var i=new Uint8Array(32);v(i,n,s,k);for(var o=new Uint8Array(8),c=0;c<8;c++)o[c]=n[c+16];return E(e,t,r,o,i)}function m(e,t,r,n,s,i,o){var c=new Uint8Array(32);v(c,i,o,k);for(var a=new Uint8Array(8),u=0;u<8;u++)a[u]=i[u+16];return g(e,t,r,n,s,a,c)}var P=function(e){var t,r,n,s,i,o,c,a;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,r=255&e[2]|(255&e[3])<<8,this.r[1]=8191&(t>>>13|r<<3),n=255&e[4]|(255&e[5])<<8,this.r[2]=7939&(r>>>10|n<<6),s=255&e[6]|(255&e[7])<<8,this.r[3]=8191&(n>>>7|s<<9),i=255&e[8]|(255&e[9])<<8,this.r[4]=255&(s>>>4|i<<12),this.r[5]=i>>>1&8190,o=255&e[10]|(255&e[11])<<8,this.r[6]=8191&(i>>>14|o<<2),c=255&e[12]|(255&e[13])<<8,this.r[7]=8065&(o>>>11|c<<5),a=255&e[14]|(255&e[15])<<8,this.r[8]=8191&(c>>>8|a<<8),this.r[9]=a>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function C(e,t,r,n,s,i){var o=new P(i);return o.update(r,n,s),o.finish(e,t),0}function S(e,t,r,n,s,i){var o=new Uint8Array(16);return C(o,0,r,n,s,i),p(e,t,o,0)}function K(e,t,r,n,s){var i;if(r<32)return-1;for(m(e,0,t,0,r,n,s),C(e,16,e,32,r-32,e),i=0;i<16;i++)e[i]=0;return 0}function M(e,t,r,n,s){var i,o=new Uint8Array(32);if(r<32)return-1;if(A(o,0,32,n,s),0!==S(t,16,t,32,r-32,o))return-1;for(m(e,0,t,0,r,n,s),i=0;i<32;i++)e[i]=0;return 0}function O(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function x(e){var t,r,n=1;for(t=0;t<16;t++)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-65536*n;e[0]+=n-1+37*(n-1)}function U(e,t,r){for(var n,s=~(r-1),i=0;i<16;i++)n=s&(e[i]^t[i]),e[i]^=n,t[i]^=n}function j(e,r){var n,s,i,o=t(),c=t();for(n=0;n<16;n++)c[n]=r[n];for(x(c),x(c),x(c),s=0;s<2;s++){for(o[0]=c[0]-65517,n=1;n<15;n++)o[n]=c[n]-65535-(o[n-1]>>16&1),o[n-1]&=65535;o[15]=c[15]-32767-(o[14]>>16&1),i=o[15]>>16&1,o[14]&=65535,U(c,o,1-i)}for(n=0;n<16;n++)e[2*n]=255&c[n],e[2*n+1]=c[n]>>8}function D(e,t){var r=new Uint8Array(32),n=new Uint8Array(32);return j(r,e),j(n,t),w(r,0,n,0)}function I(e){var t=new Uint8Array(32);return j(t,e),1&t[0]}function T(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function R(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]+r[n]}function N(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]-r[n]}function z(e,t,r){var n,s,i=0,o=0,c=0,a=0,u=0,h=0,y=0,_=0,d=0,f=0,l=0,p=0,w=0,b=0,v=0,k=0,g=0,E=0,A=0,m=0,P=0,C=0,S=0,K=0,M=0,O=0,x=0,U=0,j=0,D=0,I=0,T=r[0],R=r[1],N=r[2],z=r[3],B=r[4],L=r[5],Y=r[6],X=r[7],$=r[8],G=r[9],F=r[10],V=r[11],W=r[12],Z=r[13],H=r[14],q=r[15];i+=(n=t[0])*T,o+=n*R,c+=n*N,a+=n*z,u+=n*B,h+=n*L,y+=n*Y,_+=n*X,d+=n*$,f+=n*G,l+=n*F,p+=n*V,w+=n*W,b+=n*Z,v+=n*H,k+=n*q,o+=(n=t[1])*T,c+=n*R,a+=n*N,u+=n*z,h+=n*B,y+=n*L,_+=n*Y,d+=n*X,f+=n*$,l+=n*G,p+=n*F,w+=n*V,b+=n*W,v+=n*Z,k+=n*H,g+=n*q,c+=(n=t[2])*T,a+=n*R,u+=n*N,h+=n*z,y+=n*B,_+=n*L,d+=n*Y,f+=n*X,l+=n*$,p+=n*G,w+=n*F,b+=n*V,v+=n*W,k+=n*Z,g+=n*H,E+=n*q,a+=(n=t[3])*T,u+=n*R,h+=n*N,y+=n*z,_+=n*B,d+=n*L,f+=n*Y,l+=n*X,p+=n*$,w+=n*G,b+=n*F,v+=n*V,k+=n*W,g+=n*Z,E+=n*H,A+=n*q,u+=(n=t[4])*T,h+=n*R,y+=n*N,_+=n*z,d+=n*B,f+=n*L,l+=n*Y,p+=n*X,w+=n*$,b+=n*G,v+=n*F,k+=n*V,g+=n*W,E+=n*Z,A+=n*H,m+=n*q,h+=(n=t[5])*T,y+=n*R,_+=n*N,d+=n*z,f+=n*B,l+=n*L,p+=n*Y,w+=n*X,b+=n*$,v+=n*G,k+=n*F,g+=n*V,E+=n*W,A+=n*Z,m+=n*H,P+=n*q,y+=(n=t[6])*T,_+=n*R,d+=n*N,f+=n*z,l+=n*B,p+=n*L,w+=n*Y,b+=n*X,v+=n*$,k+=n*G,g+=n*F,E+=n*V,A+=n*W,m+=n*Z,P+=n*H,C+=n*q,_+=(n=t[7])*T,d+=n*R,f+=n*N,l+=n*z,p+=n*B,w+=n*L,b+=n*Y,v+=n*X,k+=n*$,g+=n*G,E+=n*F,A+=n*V,m+=n*W,P+=n*Z,C+=n*H,S+=n*q,d+=(n=t[8])*T,f+=n*R,l+=n*N,p+=n*z,w+=n*B,b+=n*L,v+=n*Y,k+=n*X,g+=n*$,E+=n*G,A+=n*F,m+=n*V,P+=n*W,C+=n*Z,S+=n*H,K+=n*q,f+=(n=t[9])*T,l+=n*R,p+=n*N,w+=n*z,b+=n*B,v+=n*L,k+=n*Y,g+=n*X,E+=n*$,A+=n*G,m+=n*F,P+=n*V,C+=n*W,S+=n*Z,K+=n*H,M+=n*q,l+=(n=t[10])*T,p+=n*R,w+=n*N,b+=n*z,v+=n*B,k+=n*L,g+=n*Y,E+=n*X,A+=n*$,m+=n*G,P+=n*F,C+=n*V,S+=n*W,K+=n*Z,M+=n*H,O+=n*q,p+=(n=t[11])*T,w+=n*R,b+=n*N,v+=n*z,k+=n*B,g+=n*L,E+=n*Y,A+=n*X,m+=n*$,P+=n*G,C+=n*F,S+=n*V,K+=n*W,M+=n*Z,O+=n*H,x+=n*q,w+=(n=t[12])*T,b+=n*R,v+=n*N,k+=n*z,g+=n*B,E+=n*L,A+=n*Y,m+=n*X,P+=n*$,C+=n*G,S+=n*F,K+=n*V,M+=n*W,O+=n*Z,x+=n*H,U+=n*q,b+=(n=t[13])*T,v+=n*R,k+=n*N,g+=n*z,E+=n*B,A+=n*L,m+=n*Y,P+=n*X,C+=n*$,S+=n*G,K+=n*F,M+=n*V,O+=n*W,x+=n*Z,U+=n*H,j+=n*q,v+=(n=t[14])*T,k+=n*R,g+=n*N,E+=n*z,A+=n*B,m+=n*L,P+=n*Y,C+=n*X,S+=n*$,K+=n*G,M+=n*F,O+=n*V,x+=n*W,U+=n*Z,j+=n*H,D+=n*q,k+=(n=t[15])*T,o+=38*(E+=n*N),c+=38*(A+=n*z),a+=38*(m+=n*B),u+=38*(P+=n*L),h+=38*(C+=n*Y),y+=38*(S+=n*X),_+=38*(K+=n*$),d+=38*(M+=n*G),f+=38*(O+=n*F),l+=38*(x+=n*V),p+=38*(U+=n*W),w+=38*(j+=n*Z),b+=38*(D+=n*H),v+=38*(I+=n*q),i=(n=(i+=38*(g+=n*R))+(s=1)+65535)-65536*(s=Math.floor(n/65536)),o=(n=o+s+65535)-65536*(s=Math.floor(n/65536)),c=(n=c+s+65535)-65536*(s=Math.floor(n/65536)),a=(n=a+s+65535)-65536*(s=Math.floor(n/65536)),u=(n=u+s+65535)-65536*(s=Math.floor(n/65536)),h=(n=h+s+65535)-65536*(s=Math.floor(n/65536)),y=(n=y+s+65535)-65536*(s=Math.floor(n/65536)),_=(n=_+s+65535)-65536*(s=Math.floor(n/65536)),d=(n=d+s+65535)-65536*(s=Math.floor(n/65536)),f=(n=f+s+65535)-65536*(s=Math.floor(n/65536)),l=(n=l+s+65535)-65536*(s=Math.floor(n/65536)),p=(n=p+s+65535)-65536*(s=Math.floor(n/65536)),w=(n=w+s+65535)-65536*(s=Math.floor(n/65536)),b=(n=b+s+65535)-65536*(s=Math.floor(n/65536)),v=(n=v+s+65535)-65536*(s=Math.floor(n/65536)),k=(n=k+s+65535)-65536*(s=Math.floor(n/65536)),i=(n=(i+=s-1+37*(s-1))+(s=1)+65535)-65536*(s=Math.floor(n/65536)),o=(n=o+s+65535)-65536*(s=Math.floor(n/65536)),c=(n=c+s+65535)-65536*(s=Math.floor(n/65536)),a=(n=a+s+65535)-65536*(s=Math.floor(n/65536)),u=(n=u+s+65535)-65536*(s=Math.floor(n/65536)),h=(n=h+s+65535)-65536*(s=Math.floor(n/65536)),y=(n=y+s+65535)-65536*(s=Math.floor(n/65536)),_=(n=_+s+65535)-65536*(s=Math.floor(n/65536)),d=(n=d+s+65535)-65536*(s=Math.floor(n/65536)),f=(n=f+s+65535)-65536*(s=Math.floor(n/65536)),l=(n=l+s+65535)-65536*(s=Math.floor(n/65536)),p=(n=p+s+65535)-65536*(s=Math.floor(n/65536)),w=(n=w+s+65535)-65536*(s=Math.floor(n/65536)),b=(n=b+s+65535)-65536*(s=Math.floor(n/65536)),v=(n=v+s+65535)-65536*(s=Math.floor(n/65536)),k=(n=k+s+65535)-65536*(s=Math.floor(n/65536)),i+=s-1+37*(s-1),e[0]=i,e[1]=o,e[2]=c,e[3]=a,e[4]=u,e[5]=h,e[6]=y,e[7]=_,e[8]=d,e[9]=f,e[10]=l,e[11]=p,e[12]=w,e[13]=b,e[14]=v,e[15]=k}function B(e,t){z(e,t,t)}function L(e,r){var n,s=t();for(n=0;n<16;n++)s[n]=r[n];for(n=253;n>=0;n--)B(s,s),2!==n&&4!==n&&z(s,s,r);for(n=0;n<16;n++)e[n]=s[n]}function Y(e,r){var n,s=t();for(n=0;n<16;n++)s[n]=r[n];for(n=250;n>=0;n--)B(s,s),1!==n&&z(s,s,r);for(n=0;n<16;n++)e[n]=s[n]}function X(e,r,n){var s,i,o=new Uint8Array(32),c=new Float64Array(80),u=t(),h=t(),y=t(),_=t(),d=t(),f=t();for(i=0;i<31;i++)o[i]=r[i];for(o[31]=127&r[31]|64,o[0]&=248,T(c,n),i=0;i<16;i++)h[i]=c[i],_[i]=u[i]=y[i]=0;for(u[0]=_[0]=1,i=254;i>=0;--i)U(u,h,s=o[i>>>3]>>>(7&i)&1),U(y,_,s),R(d,u,y),N(u,u,y),R(y,h,_),N(h,h,_),B(_,d),B(f,u),z(u,y,u),z(y,h,d),R(d,u,y),N(u,u,y),B(h,u),N(y,_,f),z(u,y,a),R(u,u,_),z(y,y,u),z(u,_,f),z(_,h,c),B(h,d),U(u,h,s),U(y,_,s);for(i=0;i<16;i++)c[i+16]=u[i],c[i+32]=y[i],c[i+48]=h[i],c[i+64]=_[i];var l=c.subarray(32),p=c.subarray(16);return L(l,l),z(p,p,l),j(e,p),0}function $(e,t){return X(e,t,i)}function G(e,t){return n(t,32),$(e,t)}function F(e,t,r){var n=new Uint8Array(32);return X(n,r,t),v(e,s,n,k)}P.prototype.blocks=function(e,t,r){for(var n,s,i,o,c,a,u,h,y,_,d,f,l,p,w,b,v,k,g,E=this.fin?0:2048,A=this.h[0],m=this.h[1],P=this.h[2],C=this.h[3],S=this.h[4],K=this.h[5],M=this.h[6],O=this.h[7],x=this.h[8],U=this.h[9],j=this.r[0],D=this.r[1],I=this.r[2],T=this.r[3],R=this.r[4],N=this.r[5],z=this.r[6],B=this.r[7],L=this.r[8],Y=this.r[9];r>=16;)_=y=0,_+=(A+=8191&(n=255&e[t+0]|(255&e[t+1])<<8))*j,_+=(m+=8191&(n>>>13|(s=255&e[t+2]|(255&e[t+3])<<8)<<3))*(5*Y),_+=(P+=8191&(s>>>10|(i=255&e[t+4]|(255&e[t+5])<<8)<<6))*(5*L),_+=(C+=8191&(i>>>7|(o=255&e[t+6]|(255&e[t+7])<<8)<<9))*(5*B),y=(_+=(S+=8191&(o>>>4|(c=255&e[t+8]|(255&e[t+9])<<8)<<12))*(5*z))>>>13,_&=8191,_+=(K+=c>>>1&8191)*(5*N),_+=(M+=8191&(c>>>14|(a=255&e[t+10]|(255&e[t+11])<<8)<<2))*(5*R),_+=(O+=8191&(a>>>11|(u=255&e[t+12]|(255&e[t+13])<<8)<<5))*(5*T),_+=(x+=8191&(u>>>8|(h=255&e[t+14]|(255&e[t+15])<<8)<<8))*(5*I),d=y+=(_+=(U+=h>>>5|E)*(5*D))>>>13,d+=A*D,d+=m*j,d+=P*(5*Y),d+=C*(5*L),y=(d+=S*(5*B))>>>13,d&=8191,d+=K*(5*z),d+=M*(5*N),d+=O*(5*R),d+=x*(5*T),y+=(d+=U*(5*I))>>>13,d&=8191,f=y,f+=A*I,f+=m*D,f+=P*j,f+=C*(5*Y),y=(f+=S*(5*L))>>>13,f&=8191,f+=K*(5*B),f+=M*(5*z),f+=O*(5*N),f+=x*(5*R),l=y+=(f+=U*(5*T))>>>13,l+=A*T,l+=m*I,l+=P*D,l+=C*j,y=(l+=S*(5*Y))>>>13,l&=8191,l+=K*(5*L),l+=M*(5*B),l+=O*(5*z),l+=x*(5*N),p=y+=(l+=U*(5*R))>>>13,p+=A*R,p+=m*T,p+=P*I,p+=C*D,y=(p+=S*j)>>>13,p&=8191,p+=K*(5*Y),p+=M*(5*L),p+=O*(5*B),p+=x*(5*z),w=y+=(p+=U*(5*N))>>>13,w+=A*N,w+=m*R,w+=P*T,w+=C*I,y=(w+=S*D)>>>13,w&=8191,w+=K*j,w+=M*(5*Y),w+=O*(5*L),w+=x*(5*B),b=y+=(w+=U*(5*z))>>>13,b+=A*z,b+=m*N,b+=P*R,b+=C*T,y=(b+=S*I)>>>13,b&=8191,b+=K*D,b+=M*j,b+=O*(5*Y),b+=x*(5*L),v=y+=(b+=U*(5*B))>>>13,v+=A*B,v+=m*z,v+=P*N,v+=C*R,y=(v+=S*T)>>>13,v&=8191,v+=K*I,v+=M*D,v+=O*j,v+=x*(5*Y),k=y+=(v+=U*(5*L))>>>13,k+=A*L,k+=m*B,k+=P*z,k+=C*N,y=(k+=S*R)>>>13,k&=8191,k+=K*T,k+=M*I,k+=O*D,k+=x*j,g=y+=(k+=U*(5*Y))>>>13,g+=A*Y,g+=m*L,g+=P*B,g+=C*z,y=(g+=S*N)>>>13,g&=8191,g+=K*R,g+=M*T,g+=O*I,g+=x*D,A=_=8191&(y=(y=((y+=(g+=U*j)>>>13)<<2)+y|0)+(_&=8191)|0),m=d+=y>>>=13,P=f&=8191,C=l&=8191,S=p&=8191,K=w&=8191,M=b&=8191,O=v&=8191,x=k&=8191,U=g&=8191,t+=16,r-=16;this.h[0]=A,this.h[1]=m,this.h[2]=P,this.h[3]=C,this.h[4]=S,this.h[5]=K,this.h[6]=M,this.h[7]=O,this.h[8]=x,this.h[9]=U},P.prototype.finish=function(e,t){var r,n,s,i,o=new Uint16Array(10);if(this.leftover){for(i=this.leftover,this.buffer[i++]=1;i<16;i++)this.buffer[i]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(r=this.h[1]>>>13,this.h[1]&=8191,i=2;i<10;i++)this.h[i]+=r,r=this.h[i]>>>13,this.h[i]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,o[0]=this.h[0]+5,r=o[0]>>>13,o[0]&=8191,i=1;i<10;i++)o[i]=this.h[i]+r,r=o[i]>>>13,o[i]&=8191;for(o[9]-=8192,n=(1^r)-1,i=0;i<10;i++)o[i]&=n;for(n=~n,i=0;i<10;i++)this.h[i]=this.h[i]&n|o[i];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),s=this.h[0]+this.pad[0],this.h[0]=65535&s,i=1;i<8;i++)s=(this.h[i]+this.pad[i]|0)+(s>>>16)|0,this.h[i]=65535&s;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},P.prototype.update=function(e,t,r){var n,s;if(this.leftover){for((s=16-this.leftover)>r&&(s=r),n=0;n<s;n++)this.buffer[this.leftover+n]=e[t+n];if(r-=s,t+=s,this.leftover+=s,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(s=r-r%16,this.blocks(e,t,s),t+=s,r-=s),r){for(n=0;n<r;n++)this.buffer[this.leftover+n]=e[t+n];this.leftover+=r}};var V=K,W=M;var Z=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function H(e,t,r,n){for(var s,i,o,c,a,u,h,y,_,d,f,l,p,w,b,v,k,g,E,A,m,P,C,S,K,M,O=new Int32Array(16),x=new Int32Array(16),U=e[0],j=e[1],D=e[2],I=e[3],T=e[4],R=e[5],N=e[6],z=e[7],B=t[0],L=t[1],Y=t[2],X=t[3],$=t[4],G=t[5],F=t[6],V=t[7],W=0;n>=128;){for(E=0;E<16;E++)A=8*E+W,O[E]=r[A+0]<<24|r[A+1]<<16|r[A+2]<<8|r[A+3],x[E]=r[A+4]<<24|r[A+5]<<16|r[A+6]<<8|r[A+7];for(E=0;E<80;E++)if(s=U,i=j,o=D,c=I,a=T,u=R,h=N,z,_=B,d=L,f=Y,l=X,p=$,w=G,b=F,V,C=65535&(P=V),S=P>>>16,K=65535&(m=z),M=m>>>16,C+=65535&(P=($>>>14|T<<18)^($>>>18|T<<14)^(T>>>9|$<<23)),S+=P>>>16,K+=65535&(m=(T>>>14|$<<18)^(T>>>18|$<<14)^($>>>9|T<<23)),M+=m>>>16,C+=65535&(P=$&G^~$&F),S+=P>>>16,K+=65535&(m=T&R^~T&N),M+=m>>>16,m=Z[2*E],C+=65535&(P=Z[2*E+1]),S+=P>>>16,K+=65535&m,M+=m>>>16,m=O[E%16],S+=(P=x[E%16])>>>16,K+=65535&m,M+=m>>>16,K+=(S+=(C+=65535&P)>>>16)>>>16,C=65535&(P=g=65535&C|S<<16),S=P>>>16,K=65535&(m=k=65535&K|(M+=K>>>16)<<16),M=m>>>16,C+=65535&(P=(B>>>28|U<<4)^(U>>>2|B<<30)^(U>>>7|B<<25)),S+=P>>>16,K+=65535&(m=(U>>>28|B<<4)^(B>>>2|U<<30)^(B>>>7|U<<25)),M+=m>>>16,S+=(P=B&L^B&Y^L&Y)>>>16,K+=65535&(m=U&j^U&D^j&D),M+=m>>>16,y=65535&(K+=(S+=(C+=65535&P)>>>16)>>>16)|(M+=K>>>16)<<16,v=65535&C|S<<16,C=65535&(P=l),S=P>>>16,K=65535&(m=c),M=m>>>16,S+=(P=g)>>>16,K+=65535&(m=k),M+=m>>>16,j=s,D=i,I=o,T=c=65535&(K+=(S+=(C+=65535&P)>>>16)>>>16)|(M+=K>>>16)<<16,R=a,N=u,z=h,U=y,L=_,Y=d,X=f,$=l=65535&C|S<<16,G=p,F=w,V=b,B=v,E%16==15)for(A=0;A<16;A++)m=O[A],C=65535&(P=x[A]),S=P>>>16,K=65535&m,M=m>>>16,m=O[(A+9)%16],C+=65535&(P=x[(A+9)%16]),S+=P>>>16,K+=65535&m,M+=m>>>16,k=O[(A+1)%16],C+=65535&(P=((g=x[(A+1)%16])>>>1|k<<31)^(g>>>8|k<<24)^(g>>>7|k<<25)),S+=P>>>16,K+=65535&(m=(k>>>1|g<<31)^(k>>>8|g<<24)^k>>>7),M+=m>>>16,k=O[(A+14)%16],S+=(P=((g=x[(A+14)%16])>>>19|k<<13)^(k>>>29|g<<3)^(g>>>6|k<<26))>>>16,K+=65535&(m=(k>>>19|g<<13)^(g>>>29|k<<3)^k>>>6),M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,O[A]=65535&K|M<<16,x[A]=65535&C|S<<16;C=65535&(P=B),S=P>>>16,K=65535&(m=U),M=m>>>16,m=e[0],S+=(P=t[0])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[0]=U=65535&K|M<<16,t[0]=B=65535&C|S<<16,C=65535&(P=L),S=P>>>16,K=65535&(m=j),M=m>>>16,m=e[1],S+=(P=t[1])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[1]=j=65535&K|M<<16,t[1]=L=65535&C|S<<16,C=65535&(P=Y),S=P>>>16,K=65535&(m=D),M=m>>>16,m=e[2],S+=(P=t[2])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[2]=D=65535&K|M<<16,t[2]=Y=65535&C|S<<16,C=65535&(P=X),S=P>>>16,K=65535&(m=I),M=m>>>16,m=e[3],S+=(P=t[3])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[3]=I=65535&K|M<<16,t[3]=X=65535&C|S<<16,C=65535&(P=$),S=P>>>16,K=65535&(m=T),M=m>>>16,m=e[4],S+=(P=t[4])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[4]=T=65535&K|M<<16,t[4]=$=65535&C|S<<16,C=65535&(P=G),S=P>>>16,K=65535&(m=R),M=m>>>16,m=e[5],S+=(P=t[5])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[5]=R=65535&K|M<<16,t[5]=G=65535&C|S<<16,C=65535&(P=F),S=P>>>16,K=65535&(m=N),M=m>>>16,m=e[6],S+=(P=t[6])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[6]=N=65535&K|M<<16,t[6]=F=65535&C|S<<16,C=65535&(P=V),S=P>>>16,K=65535&(m=z),M=m>>>16,m=e[7],S+=(P=t[7])>>>16,K+=65535&m,M+=m>>>16,M+=(K+=(S+=(C+=65535&P)>>>16)>>>16)>>>16,e[7]=z=65535&K|M<<16,t[7]=V=65535&C|S<<16,W+=128,n-=128}return n}function q(e,t,r){var n,s=new Int32Array(8),i=new Int32Array(8),o=new Uint8Array(256),c=r;for(s[0]=1779033703,s[1]=3144134277,s[2]=1013904242,s[3]=2773480762,s[4]=1359893119,s[5]=2600822924,s[6]=528734635,s[7]=1541459225,i[0]=4089235720,i[1]=2227873595,i[2]=4271175723,i[3]=1595750129,i[4]=2917565137,i[5]=725511199,i[6]=4215389547,i[7]=327033209,H(s,i,t,r),r%=128,n=0;n<r;n++)o[n]=t[c-r+n];for(o[r]=128,o[(r=256-128*(r<112?1:0))-9]=0,f(o,r-8,c/536870912|0,c<<3),H(s,i,o,r),n=0;n<8;n++)f(e,8*n,s[n],i[n]);return 0}function J(e,r){var n=t(),s=t(),i=t(),o=t(),c=t(),a=t(),u=t(),y=t(),_=t();N(n,e[1],e[0]),N(_,r[1],r[0]),z(n,n,_),R(s,e[0],e[1]),R(_,r[0],r[1]),z(s,s,_),z(i,e[3],r[3]),z(i,i,h),z(o,e[2],r[2]),R(o,o,o),N(c,s,n),N(a,o,i),R(u,o,i),R(y,s,n),z(e[0],c,a),z(e[1],y,u),z(e[2],u,a),z(e[3],c,y)}function Q(e,t,r){var n;for(n=0;n<4;n++)U(e[n],t[n],r)}function ee(e,r){var n=t(),s=t(),i=t();L(i,r[2]),z(n,r[0],i),z(s,r[1],i),j(e,s),e[31]^=I(n)<<7}function te(e,t,r){var n,s;for(O(e[0],o),O(e[1],c),O(e[2],c),O(e[3],o),s=255;s>=0;--s)Q(e,t,n=r[s/8|0]>>(7&s)&1),J(t,e),J(e,e),Q(e,t,n)}function re(e,r){var n=[t(),t(),t(),t()];O(n[0],y),O(n[1],_),O(n[2],c),z(n[3],y,_),te(e,n,r)}function ne(e,r,s){var i,o=new Uint8Array(64),c=[t(),t(),t(),t()];for(s||n(r,32),q(o,r,32),o[0]&=248,o[31]&=127,o[31]|=64,re(c,o),ee(e,c),i=0;i<32;i++)r[i+32]=e[i];return 0}var se=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ie(e,t){var r,n,s,i;for(n=63;n>=32;--n){for(r=0,s=n-32,i=n-12;s<i;++s)t[s]+=r-16*t[n]*se[s-(n-32)],r=t[s]+128>>8,t[s]-=256*r;t[s]+=r,t[n]=0}for(r=0,s=0;s<32;s++)t[s]+=r-(t[31]>>4)*se[s],r=t[s]>>8,t[s]&=255;for(s=0;s<32;s++)t[s]-=r*se[s];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function oe(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;ie(e,r)}function ce(e,r,n,s){var i,o,c=new Uint8Array(64),a=new Uint8Array(64),u=new Uint8Array(64),h=new Float64Array(64),y=[t(),t(),t(),t()];q(c,s,32),c[0]&=248,c[31]&=127,c[31]|=64;var _=n+64;for(i=0;i<n;i++)e[64+i]=r[i];for(i=0;i<32;i++)e[32+i]=c[32+i];for(q(u,e.subarray(32),n+32),oe(u),re(y,u),ee(e,y),i=32;i<64;i++)e[i]=s[i];for(q(a,e,n+64),oe(a),i=0;i<64;i++)h[i]=0;for(i=0;i<32;i++)h[i]=u[i];for(i=0;i<32;i++)for(o=0;o<32;o++)h[i+o]+=a[i]*c[o];return ie(e.subarray(32),h),_}function ae(e,r,n,s){var i,a=new Uint8Array(32),h=new Uint8Array(64),y=[t(),t(),t(),t()],_=[t(),t(),t(),t()];if(n<64)return-1;if(function(e,r){var n=t(),s=t(),i=t(),a=t(),h=t(),y=t(),_=t();return O(e[2],c),T(e[1],r),B(i,e[1]),z(a,i,u),N(i,i,e[2]),R(a,e[2],a),B(h,a),B(y,h),z(_,y,h),z(n,_,i),z(n,n,a),Y(n,n),z(n,n,i),z(n,n,a),z(n,n,a),z(e[0],n,a),B(s,e[0]),z(s,s,a),D(s,i)&&z(e[0],e[0],d),B(s,e[0]),z(s,s,a),D(s,i)?-1:(I(e[0])===r[31]>>7&&N(e[0],o,e[0]),z(e[3],e[0],e[1]),0)}(_,s))return-1;for(i=0;i<n;i++)e[i]=r[i];for(i=0;i<32;i++)e[i+32]=s[i];if(q(h,e,n),oe(h),te(y,_,h),re(_,r.subarray(32)),J(y,_),ee(a,y),n-=64,w(r,0,a,0)){for(i=0;i<n;i++)e[i]=0;return-1}for(i=0;i<n;i++)e[i]=r[i+64];return n}var ue=32,he=24,ye=32,_e=32,de=he;function fe(e,t){if(e.length!==ue)throw new Error("bad key size");if(t.length!==he)throw new Error("bad nonce size")}function le(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function pe(e){for(var t=0;t<e.length;t++)e[t]=0}e.lowlevel={crypto_core_hsalsa20:v,crypto_stream_xor:m,crypto_stream:A,crypto_stream_salsa20_xor:g,crypto_stream_salsa20:E,crypto_onetimeauth:C,crypto_onetimeauth_verify:S,crypto_verify_16:p,crypto_verify_32:w,crypto_secretbox:K,crypto_secretbox_open:M,crypto_scalarmult:X,crypto_scalarmult_base:$,crypto_box_beforenm:F,crypto_box_afternm:V,crypto_box:function(e,t,r,n,s,i){var o=new Uint8Array(32);return F(o,s,i),V(e,t,r,n,o)},crypto_box_open:function(e,t,r,n,s,i){var o=new Uint8Array(32);return F(o,s,i),W(e,t,r,n,o)},crypto_box_keypair:G,crypto_hash:q,crypto_sign:ce,crypto_sign_keypair:ne,crypto_sign_open:ae,crypto_secretbox_KEYBYTES:ue,crypto_secretbox_NONCEBYTES:he,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:ye,crypto_box_SECRETKEYBYTES:_e,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:de,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:u,L:se,pack25519:j,unpack25519:T,M:z,A:R,S:B,Z:N,pow2523:Y,add:J,set25519:O,modL:ie,scalarmult:te,scalarbase:re},e.randomBytes=function(e){var t=new Uint8Array(e);return n(t,e),t},e.secretbox=function(e,t,r){le(e,t,r),fe(r,t);for(var n=new Uint8Array(32+e.length),s=new Uint8Array(n.length),i=0;i<e.length;i++)n[i+32]=e[i];return K(s,n,n.length,t,r),s.subarray(16)},e.secretbox.open=function(e,t,r){le(e,t,r),fe(r,t);for(var n=new Uint8Array(16+e.length),s=new Uint8Array(n.length),i=0;i<e.length;i++)n[i+16]=e[i];return n.length<32?null:0!==M(s,n,n.length,t,r)?null:s.subarray(32)},e.secretbox.keyLength=ue,e.secretbox.nonceLength=he,e.secretbox.overheadLength=16,e.scalarMult=function(e,t){if(le(e,t),32!==e.length)throw new Error("bad n size");if(32!==t.length)throw new Error("bad p size");var r=new Uint8Array(32);return X(r,e,t),r},e.scalarMult.base=function(e){if(le(e),32!==e.length)throw new Error("bad n size");var t=new Uint8Array(32);return $(t,e),t},e.scalarMult.scalarLength=32,e.scalarMult.groupElementLength=32,e.box=function(t,r,n,s){var i=e.box.before(n,s);return e.secretbox(t,r,i)},e.box.before=function(e,t){le(e,t),function(e,t){if(e.length!==ye)throw new Error("bad public key size");if(t.length!==_e)throw new Error("bad secret key size")}(e,t);var r=new Uint8Array(32);return F(r,e,t),r},e.box.after=e.secretbox,e.box.open=function(t,r,n,s){var i=e.box.before(n,s);return e.secretbox.open(t,r,i)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(ye),t=new Uint8Array(_e);return G(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(le(e),e.length!==_e)throw new Error("bad secret key size");var t=new Uint8Array(ye);return $(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=ye,e.box.secretKeyLength=_e,e.box.sharedKeyLength=32,e.box.nonceLength=de,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(le(e,t),64!==t.length)throw new Error("bad secret key size");var r=new Uint8Array(64+e.length);return ce(r,e,e.length,t),r},e.sign.open=function(e,t){if(le(e,t),32!==t.length)throw new Error("bad public key size");var r=new Uint8Array(e.length),n=ae(r,e,e.length,t);if(n<0)return null;for(var s=new Uint8Array(n),i=0;i<s.length;i++)s[i]=r[i];return s},e.sign.detached=function(t,r){for(var n=e.sign(t,r),s=new Uint8Array(64),i=0;i<s.length;i++)s[i]=n[i];return s},e.sign.detached.verify=function(e,t,r){if(le(e,t,r),64!==t.length)throw new Error("bad signature size");if(32!==r.length)throw new Error("bad public key size");var n,s=new Uint8Array(64+e.length),i=new Uint8Array(64+e.length);for(n=0;n<64;n++)s[n]=t[n];for(n=0;n<e.length;n++)s[n+64]=e[n];return ae(i,s,s.length,r)>=0},e.sign.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(64);return ne(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(le(e),64!==e.length)throw new Error("bad secret key size");for(var t=new Uint8Array(32),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(le(e),32!==e.length)throw new Error("bad seed size");for(var t=new Uint8Array(32),r=new Uint8Array(64),n=0;n<32;n++)r[n]=e[n];return ne(t,r,!0),{publicKey:t,secretKey:r}},e.sign.publicKeyLength=32,e.sign.secretKeyLength=64,e.sign.seedLength=32,e.sign.signatureLength=64,e.hash=function(e){le(e);var t=new Uint8Array(64);return q(t,e,e.length),t},e.hash.hashLength=64,e.verify=function(e,t){return le(e,t),0!==e.length&&0!==t.length&&(e.length===t.length&&0===l(e,0,t,0,e.length))},e.setPRNG=function(e){n=e},function(){var t="undefined"!=typeof self?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){e.setPRNG((function(e,r){var n,s=new Uint8Array(r);for(n=0;n<r;n+=65536)t.getRandomValues(s.subarray(n,n+Math.min(r-n,65536)));for(n=0;n<r;n++)e[n]=s[n];pe(s)}))}else(t=r(39))&&t.randomBytes&&e.setPRNG((function(e,r){var n,s=t.randomBytes(r);for(n=0;n<r;n++)e[n]=s[n];pe(s)}))}()}(e.exports?e.exports:self.nacl=self.nacl||{})},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),s=r(1),i=r(0),o=r(8),c=r(26),a=r(3);class u{constructor(){this.version=-1,this.prekey_id=-1,this.public_key=new a.PublicKey,this.identity_key=new o.IdentityKey,this.signature=null}static new(e,t){const r=i.new_instance(u);return r.version=1,r.prekey_id=t.key_id,r.public_key=t.key_pair.public_key,r.identity_key=e,r.signature=null,r}static signed(e,t){const r=t.key_pair.public_key,n=e.secret_key.sign(r.pub_edward),s=i.new_instance(u);return s.version=1,s.prekey_id=t.key_id,s.public_key=r,s.identity_key=e.public_key,s.signature=n,s}verify(){return this.signature?this.identity_key.public_key.verify(this.signature,this.public_key.pub_edward)?c.PreKeyAuth.VALID:c.PreKeyAuth.INVALID:c.PreKeyAuth.UNKNOWN}serialise(){const e=new n.Encoder;return this.encode(e),e.get_buffer()}serialised_json(){return{id:this.prekey_id,key:s.to_base64(new Uint8Array(this.serialise()),s.base64_variants.ORIGINAL)}}static deserialise(e){return u.decode(new n.Decoder(e))}encode(e){return e.object(5),e.u8(0),e.u8(this.version),e.u8(1),e.u16(this.prekey_id),e.u8(2),this.public_key.encode(e),e.u8(3),this.identity_key.encode(e),e.u8(4),this.signature?e.bytes(this.signature):e.null()}static decode(e){const t=i.new_instance(u),r=e.object();for(let n=0;n<=r-1;n++)switch(e.u8()){case 0:t.version=e.u8();break;case 1:t.prekey_id=e.u16();break;case 2:t.public_key=a.PublicKey.decode(e);break;case 3:t.identity_key=o.IdentityKey.decode(e);break;case 4:t.signature=e.optional(()=>new Uint8Array(e.bytes()));break;default:e.skip()}return t}}t.PreKeyBundle=u},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(9)),n(r(28)),n(r(17)),n(r(18)),n(r(21))},function(e,t){},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(10)),n(r(22)),n(r(44)),n(r(29)),n(r(30)),n(r(31)),n(r(32)),n(r(33))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PreKeyStore=class{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(13);t.ArrayUtil=n;const s=r(0);t.ClassUtil=s;const i=r(23);t.KeyDerivationUtil=i;const o=r(7);t.MemoryUtil=o;const c=r(27);t.RandomUtil=c;const a=r(46);t.WASMUtil=a},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=r(1);t.isUsingWASM=()=>n(void 0,void 0,void 0,(function*(){yield s.ready;const e=s.libsodium;return Boolean(e.usesWasm)||Boolean(e.useBackupModule)}))}]);
//# sourceMappingURL=proteus.bundle.js.map